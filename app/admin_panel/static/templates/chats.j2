{% extends "main.j2" %}
{% block page %}
<div class="h-100 d-flex flex-row">
    <div class="h-100 d-flex flex-column" style="width: 15%; background-color: #ebebeb;">
        <div class="d-flex flex-column list-group list-group-flush border-bottom scrollarea overflow-auto">
            {% for chat in chats %}
            {% set active = 'active' if selected_chat and chat.uid == selected_chat.uid else '' %}
            <a href="{{ url_for('admin_panel_chat', chat_uid=chat.uid) if not selected_chat or chat.uid != selected_chat.uid else '#' }}"
                class="list-group-item list-group-item-action py-3 {{ active }}" aria-current="true">
                Chat {{ chat.uid }}
            </a>
            {% endfor %}
        </div>
    </div>
    {% if selected_chat %}
    <div class="h-100 w-100 d-flex flex-row">
        <div class="d-flex flex-column align-items-flex-start p-3 shadow" style="width:20%">
            <h3 class="align-self-center">Info</h3>
            <p class="mt-3"><span class="fw-medium">First Name:</span> {{ selected_chat.first_name if
                selected_chat.first_name else '-' }}</p>
            <p><span class="fw-medium">Last Name:</span> {{ selected_chat.last_name if selected_chat.last_name else '-'
                }}</p>
            <p><span class="fw-medium">Patronymic Name:</span> {{ selected_chat.patronymic_name if
                selected_chat.patronymic_name else '-' }}</p>
            <p class="mt-3"><span class="fw-medium">Email:</span> {{ selected_chat.email if selected_chat.email else '-'
                }}</p>
            <p><span class="fw-medium">Tel.:</span> {{ selected_chat.phone_number if selected_chat.phone_number else '-'
                }}</p>
        </div>
        <div class="d-flex flex-column h-100 w-100 p-3">
            <h3 class="align-self-center">Chat {{selected_chat.uid}}</h3>
            {# Messages #}
            <div class="d-flex flex-column flex-1 p-3" style="overflow-y: auto; ">
                {% for msg in messages %}
                <div
                    class="d-flex mb-3 {% if msg.is_outgoing %}justify-content-end{% else %}justify-content-start{% endif %}">
                    <div class="p-2 px-3 rounded-3 
                                    {% if msg.is_outgoing %}
                                        bg-primary text-white
                                    {% else %}
                                        bg-light border
                                    {% endif %}" style="max-width: 30%;">
                        <div class="mb-1">
                            {{ msg.text }}
                        </div>

                        {% for file in msg.files | reverse %}
                        {% if file.mime_type in ["image/jpeg", "image/png"] %}
                        <img src="{{ url_for('admin_panel_download_message_file', file_uid=file.uid) }}" alt="image"
                            class="img-fluid rounded mt-2" style="max-width: 50%;">
                        {% else %}
                        <div class="mt-2">
                            ðŸ“Ž <a href="{{ url_for('admin_panel_download_message_file', file_uid=file.uid) }}"
                                class="text-decoration-underline text-reset" download>{{ file.name }}</a>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {# Messages END #}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}