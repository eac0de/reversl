{% extends "base.j2" %}
{% block page %}
<div class="h-100 w-100 d-flex">
    <div class="d-flex flex-column align-items-stretch flex-shrink-0 bg-body-tertiary"
        style="width: 280px; height: 100%;">
        <div class="d-flex flex-column list-group list-group-flush border-bottom scrollarea overflow-auto"
            style="scrollbar-width: none;">
            {% for chat in chats %}
            <a href="{{ url_for('admin_panel_chat', chat_uid=chat.uid) if not selected_chat or chat.uid != selected_chat.uid else '#' }}"
                class="list-group-item list-group-item-action py-3 lh-sm {{ 'active' if selected_chat and chat.uid == selected_chat.uid}}"
                aria-current="true">
                <strong class="mb-1">{{ chat.uid }}</strong>
            </a>
            {% endfor %}
        </div>
    </div>
    <div class="d-flex flex-row w-100">
        {% if selected_chat %}
        <div style="width: 280px;">
            <p class="mt-3">First Name:{{ selected_chat.first_name }}</p>
            <p class="mt-3">Last Name:{{ selected_chat.last_name }}</p>
            <p class="mt-3">Patronymic Name:{{ selected_chat.patronymic_name }}</p>
        </div>
        <div class="d-flex flex-column w-100" style="background-color: #706767;">
            {% for msg in messages %}
            <p class="mt-3">Message:{{ msg.text }}</p>
            {% for file in msg.files %}
            {% if file.mime_type in ["image/jpeg", "image/png"]%}
            <img src="{{ url_for('admin_panel_download_message_file', file_uid=file.uid) }}" alt="image"
                style="margin-left: 30px; max-width: 200px; max-height: 200px;">
            {% else %}
            <p style="margin-left: 30px;">{{file.name}}</p>
            {% endif %}
            {% endfor %}
            {% endfor %}
            <div class="mt-auto p-3">
                <form enctype="multipart/form-data"
                    action="{{ url_for('admin_panel_send_message', chat_uid=selected_chat.uid) }}" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ request.state.csrf_token }}">
                    <div class="input-group mb-2">
                        <input type="text" name="text" class="form-control" placeholder="Type your message..."
                            aria-label="Message input">
                        <button class="btn btn-primary" type="submit">Send</button>
                    </div>
                    <div>
                        <input type="file" name="files" class="form-control" multiple accept="image/*,.pdf,.doc,.docx">
                    </div>
                </form>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}